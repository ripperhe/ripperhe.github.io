---
layout: post
title:  ä¸€ä¸ªå®žç”¨çš„æ‚¬æµ®çƒå·¥å…·
categories: iOS
description: æ‚¬æµ®çƒ
keywords: iOS, ZYSuspensionView
---

## å‰è¨€

å·²ç»å¾ˆä¹…æ²¡æœ‰å†™æ–‡ç« äº†ï¼Œå‰é¢å†™è¿‡ä¸€ç¯‡ [å…³äºŽ UIWindow çš„æ–‡ç« ](http://www.jianshu.com/p/98cd7fc4bfba)ï¼Œåœ¨æ–‡ç« çš„æœ€åŽæè¿‡æ‚¬æµ®çƒã€‚ç”¨ UIWindow æ¥åšæ‚¬æµ®çƒï¼Œå¯ä»¥æ‚¬æµ®åœ¨ä»»æ„é¡µé¢ï¼ŒåŸºäºŽè¿™ä¸ªç‰¹æ€§ï¼Œæˆ‘å°†å…¶åšæˆäº†ä¸€ä¸ªå·¥å…·ï¼Œç”¨åœ¨æˆ‘ä»¬çš„é¡¹ç›®å¼€å‘ä¸­ï¼Œä»Šå¤©æŠŠå®ƒä½œä¸ºä¸»è§’æ¥è®²ä¸€è®²ã€‚

å…ˆä¸Šä»£ç  â†’ [ZYSuspensionView GitHub ä¼ é€é—¨](https://github.com/ripperhe/ZYSuspensionView)

## ä¸ºä»€ä¹ˆä¼šæœ‰å®ƒ

### æƒ³è¦æŒ‡å®šæ‰§è¡Œä¸€äº›ä»£ç 

åœ¨åšå…¬å¸é¡¹ç›®çš„æ—¶å€™ï¼Œå¯èƒ½ä¼šæœ‰è¿™æ ·çš„æƒ…å†µï¼Œæˆ‘éœ€è¦åœ¨ç¬¬ä¸€ä¸ªè¿›æŸä¸ªé¡µé¢çš„æ—¶å€™å¼¹å‡ºä¸€äº›ä¸œè¥¿ï¼Œç®€å•åšæ³•ï¼Œå¯èƒ½å°±ä¼šå†ã€åœ¨ NSUserDefaults ä¸­è®°å½•ä¸€ä¸ªå€¼ï¼Œè¡¨æ˜Žå¼¹å‡ºè¿‡ã€‚å¯èƒ½æˆ‘ç¬¬ä¸€æ¬¡å¼¹å‡ºä¹‹åŽåˆä¸€äº›é—®é¢˜ï¼Œæˆ‘æ”¹äº†ä»£ç ï¼Œè¿è¡Œå·¥ç¨‹ï¼Œé‡æ–°è¿›é¡µé¢è®©å®ƒå¼¹å‡ºï¼Œå¯æ˜¯å´å¼¹ä¸å‡ºæ¥äº†ï¼Œå› ä¸ºå·²ç»æ ‡è®°ä¸ºå¼¹å‡ºè¿‡ï¼ŒæŠŠåŒ…åˆ äº†ï¼Œé‡è¿è¡Œå·¥ç¨‹å³å¯ã€‚

![testmanager.gif](http://upload-images.jianshu.io/upload_images/939125-c7ec6a881d461bd0.gif?imageMogr2/auto-orient/strip)

ä¸è¿‡æœ‰äº†æ‚¬æµ®çƒï¼Œæˆ‘é€šè¿‡ç‚¹å‡»æ‚¬æµ®çƒï¼Œå¼¹å‡ºä¸€ä¸ªåˆ—è¡¨ï¼Œåˆ—è¡¨ä¸­æ¯ä¸ª cell å¯¹åº”æˆ‘é¢„å…ˆå†™å¥½çš„ä¸€äº›å¸¸ç”¨ä»£ç ï¼Œä¾‹å¦‚æ¸…é™¤ NSUserDefaults æ‰€æœ‰é”®å€¼å¯¹ç­‰ç­‰ï¼Œç„¶åŽå°±è¾¾åˆ°äº†æƒ³è¦çš„æ•ˆæžœã€‚å½“ç„¶è¿™ä¸ªæ¯”å–»æœ‰å¾ˆå¤šæ§½ç‚¹ï¼Œä¸è¿‡å°±è¿™æ ·å§ï¼Œä¸çº ç»“ã€‚

çœŸå®žç”¨ä¾‹å¦‚ä¸‹ï¼Œå¸Œæœ›å¯¹ä½ æœ‰ç‚¹å¯å‘ï¼š

1. é€šè¿‡æ‰‹åŠ¨æ’å…¥ä¸€æ¡çš„æŒ‡å®šä½“é‡ä½“è„‚çŽ‡çš„ä½“é‡æ•°æ®

	æˆ‘ä»¬å…¬å¸åšä½“è„‚ç§¤ï¼Œæ‰€ä»¥å¼€å‘çš„æ—¶å€™ç»å¸¸éœ€è¦è¿™ä¹ˆåšï¼Œä¸ç„¶å°±å¾—å…‰ç€è„šåœ¨ç§¤ä¸Šç§°ï¼Œè¿˜ä¸ä¸€å®šæ˜¯è‡ªå·±æƒ³è¦çš„æ•°å€¼
2. æ¸…é™¤ NSUserDefaultsï¼Œè®©åŒ…é‡Œçš„æ ‡è®°å¹²å‡€å¾—åƒåˆæ‹ä¸€æ ·
3. æ˜¾ç¤º log 

	æœ‰æ—¶å€™æµ‹è¯•äººå‘˜æµ‹è¯•çš„æ—¶å€™ï¼Œå‘çŽ°é¡µé¢çš„ bugï¼Œå¯èƒ½æˆ‘ä»¬åœ¨æœ‰äº› case é¢„ç•™äº†ä¸€äº› logï¼Œä½†æ˜¯æƒ³è¦å¯¼å‡ºå°±éº»çƒ¦ä¸€äº›ï¼Œé€šè¿‡ç‚¹æ‚¬æµ®çƒåˆ—è¡¨çš„æŸä¸ª cell è·³è½¬åˆ°ä¸€ä¸ªæ˜¾ç¤º log çš„é¡µé¢ï¼Œå¿«æ·æ–¹ä¾¿
	
4. æ˜¾ç¤ºå½“å‰è´¦å·çš„ user id åŠå…¶ä»–ä¿¡æ¯

	æˆ‘ä»¬éœ€è¦ç»å¸¸æŸ¥å½“å‰è´¦å·ä¿¡æ¯
	
5. è·³è½¬åˆ°æŒ‡å®šé¡µé¢

	æ­£åœ¨å¼€å‘æŸä¸ªé¡µé¢ï¼Œéœ€è¦ä¾èµ–å·¥ç¨‹é‡Œçš„ä¸œè¥¿ï¼Œæ‰€ä»¥åœ¨å·¥ç¨‹é‡Œå¼€å‘ï¼Œä½†æ˜¯è¿˜æ²¡æœ‰å¼€å‘å®Œï¼Œç”±äºŽå…¥å£æ·±ï¼Œæ¯æ¬¡æ”¹äº†ä¸€äº›ä¸œè¥¿é‡æ–°è·‘å·¥ç¨‹è¿˜å¾—ç‚¹å‡ ä¸‹ï¼Œéº»çƒ¦ã€‚ä¿®æ”¹ app é¦–é¡µçš„æŸä¸ªæŒ‰é’®ç‚¹å‡»äº‹ä»¶ï¼Œç›´æŽ¥ç‚¹å‡»è¿›å…¥ä¹Ÿä¸åˆé€‚ï¼Œå½±å“æ­£å¼ä»£ç ï¼Œè€Œä¸”å®¹æ˜“å¿˜è®°æ”¹å›žæ¥ã€‚
	
6. å…¶ä»–ä¸€äº›æ‚ä¸ƒæ‚å…«çš„...

### ä¸æƒ³æ¯æ¬¡éƒ½è¾“å…¥è´¦å·å¯†ç 

å› ä¸ºé¡¹ç›®çš„åŽŸå› ï¼Œå¾ˆå¤šåŠŸèƒ½å±•ç¤ºéƒ½å’Œå½“å‰è´¦å·çš„æ•°æ®æœ‰å…³ç³»ï¼Œæ‰€ä»¥æƒ³è¦è‡ªæµ‹è‡ªå·±çš„åŠŸèƒ½æ˜¯å¦ OKï¼Œå°±éœ€è¦é¢‘ç¹åˆ‡æ¢è´¦å·ï¼Œä»¥ä¿è¯æ¯ç§æƒ…å†µéƒ½æ˜¯çœŸå®ž cover åˆ°äº†ã€‚

![loginmanager.gif](http://upload-images.jianshu.io/upload_images/939125-c954813dc16624d4.gif?imageMogr2/auto-orient/strip)

ç”¨æ‚¬æµ®çƒï¼Œå¼¹å‡ºä¸€ä¸ªè´¦å·èœå•ï¼Œç‚¹å‡»è‡ªå·±æƒ³è¦ç™»é™†çš„è´¦å·ï¼Œç›´æŽ¥è‡ªåŠ¨ç™»é™†ï¼Œå¦ˆå¦ˆå†ä¹Ÿä¸ç”¨æ‹…å¿ƒæˆ‘æ¯å¤©éƒ½è¦è¾“å…¥å‡ ç™¾æ¬¡å¯†ç äº†ã€‚ ðŸ¤£


## å¥½ç”¨å—ï¼Ÿæ€Žä¹ˆç”¨ï¼Ÿ

ä¸ªäººæ„Ÿè§‰è¿˜æ˜¯å¾ˆå¥½ç”¨äº†ï¼Œä¸ºè‡ªå·±å¼€å‘çœåŽ»äº†ä¸å°‘æ—¶é—´ï¼ŒåŒæ—¶ä¹Ÿä¸ºæµ‹è¯•åŒå­¦çœåŽ»ä¸å°‘éº»çƒ¦ï¼ˆæœ‰ç‚¹è‡ªå–è‡ªå¤¸çš„æ€§è´¨äº†å“ˆ ðŸ˜ ï¼‰ã€‚é¡µé¢ç®€å•æœ´ç´ ï¼Œå°±æ˜¯æ‚¬æµ®çƒ + ä¸€ä¸ªåˆ—è¡¨ï¼Œå’±ä¸æ•´é‚£äº›è™šçš„ï¼Œä¸»è¦å°±æ˜¯å®žç”¨ã€‚å¥½ä¸å¥½ç”¨ï¼Œè¯•è¯•å°±çŸ¥é“äº†ã€‚

æˆ‘å·²ç»å°†è¿™ä¸ªæ‚¬æµ®çƒåšæˆäº†ä¸€ä¸ª Pod åº“ï¼Œå…¬å¸çš„é¡¹ç›®ç”¨äº†è¿‘ä¸€å¹´äº†ï¼Œç¨³å®šï¼Œæš‚æœªå‘çŽ°æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œå¦‚æœ‰ bug å¯ä»¥ç»™æˆ‘æ issueã€‚

è¿™ä¸ªç»„ä»¶ä¸»è¦åˆ†ä¸ºä¸ªéƒ¨åˆ†

* SuspensionView
* TestManager
* LoginManager

SuspensionView å°±æ˜¯å•çº¯ä¸€ä¸ªæ‚¬æµ®çƒï¼Œå¯ä»¥å•ç‹¬é›†æˆã€‚

### TestManager 

TestManager æ˜¯ä¸€ä¸ªå•ä¾‹ï¼Œå°†ä½ é¢„å…ˆå†™å¥½çš„ä»£ç å—ä¿å­˜å¥½ï¼Œç„¶åŽé€šè¿‡ç‚¹å‡»æ‚¬æµ®åˆ—è¡¨çš„æŸä¸ª cell æ‰§è¡Œç›¸åº”ä»£ç å—ã€‚

ä½¿ç”¨çš„æ—¶å€™ï¼Œä¸€èˆ¬åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼š

ä¸€äº›æ˜¯å¸¸é©»çš„ä¸€äº›æµ‹è¯•ä»£ç ï¼Œä¾‹å¦‚å±•ç¤º logï¼Œæ¸…é™¤ user defaults ç­‰...

```objc
NSArray *baseArray = @[
                       @{
                           kTestTitleKey: @"clean user defaults",
                           kTestAutoCloseKey: @YES,
                           kTestActionKey: ^{
                               NSLog(@"click 'clean user defaults'");
                               [self cleanUserDefaults];
                           }
                           },
                       @{
                           kTestTitleKey:@"something",
                           kTestAutoCloseKey: @NO,
                           kTestActionKey:^{
                               NSLog(@"click 'something'");
                           }
                           },
                       ];
    
[ZYTestManager setupPermanentTestItemArray:baseArray];
```

* `kTestTitleKey` æ˜¯æµ‹è¯•æ¡ç›®çš„åå­—
* `kTestAutoCloseKey` ä¸ºç‚¹å‡»è¯¥æ¡ç›®ä¹‹åŽæ˜¯å¦è‡ªåŠ¨å…³é—­æ‚¬æµ®åˆ—è¡¨
* `kTestActionKey` å¾ˆæ˜¾ç„¶ï¼Œè¿™å°±æ˜¯ç‚¹å‡»ä¹‹åŽæƒ³è¦æ‰§è¡Œçš„ä»£ç 

å½“ç„¶ï¼Œä¸€äº›ä¸å¸¸ç”¨çš„æµ‹è¯•ä»£ç ï¼Œå¯èƒ½å°±æ˜¯ä½ çªå‘å¥‡æƒ³è¦è·³è½¬åˆ°æŸä¸ªé¡µé¢ï¼Œä½†æ˜¯ä¸å½±å“é¡¹ç›®çš„å…¶ä»–åŠŸèƒ½æ­£å¸¸è¿è¡Œï¼Œå°±å¯ä»¥ä½¿ç”¨å¦ä¸€ä¸ªæ–¹æ³•

```objc
[ZYTestManager addTestItemWithTitle:@"new item" autoClose:YES action:^{
    // click new item : do something ~~~~~~~~~~
}];
```
è¿™é‡Œéœ€è¦è¯´æ˜Žä¸€äº›ï¼Œä¼ å…¥ block çš„æ—¶å€™ï¼Œå¦‚æžœç”¨åˆ° selfï¼Œæœ€å¥½ä½¿ç”¨ __weakï¼Œé¿å…å½±å“åˆ°ä½ æ­£å¸¸åŠŸèƒ½ï¼Œæ¯•ç«Ÿ TestManager æ˜¯ä¸€ä¸ªå•ä¾‹ã€‚


### LoginManager

LoginManager é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯æ‹¿æ¥åšè‡ªåŠ¨ç™»å½•çš„ï¼ŒåŒæ ·ï¼Œç‚¹å‡» login æ‚¬æµ®çƒï¼Œå¼¹å‡ºè´¦å·åˆ—è¡¨ï¼Œå†ç‚¹å‡»å¯¹äºŽ cellï¼ŒLoginManager ä¼šå›žè°ƒç»™ä½ å‚¨å­˜å¥½çš„è¿™ä¸ªè´¦å·çš„è´¦å·å’Œå¯†ç ã€‚

```objc
- (void)loginManager:(ZYLoginManager *)loginManager loginWithAccout:(NSString *)account password:(NSString *)password
{
	// è¿™é‡ŒåŽ»å®žçŽ°ä½ çš„è‡ªåŠ¨ç™»å½•
}
```

å¯èƒ½ä½ ä¼šè¯´ï¼Œè‡ªåŠ¨ç™»å½•éƒ½æ˜¯æˆ‘å®žçŽ°äº†ï¼Œæ‹¿ä½ è¿˜æœ‰ä»€ä¹ˆç”¨å‘¢ã€‚LoginManager åšäº†å¦‚ä¸‹äº‹æƒ…ï¼š

* å¸®ä½ å­˜å‚¨è´¦å·å¯†ç 
* åˆ—è¡¨å±•ç¤ºä½ é¢„å…ˆè®¾ç½®æˆ–è€…ç™»å½•è¿‡çš„è´¦å·ï¼Œå¹¶é€šè¿‡ä½ çš„ç‚¹å‡»å›žè°ƒç»™ä½ 

è‡ªåŠ¨ç™»å½•çš„ä»£ç æ˜¯ä¸å¯èƒ½å¸®ä½ åšå¥½çš„ï¼Œå› ä¸ºæ¯ä¸ªå·¥ç¨‹é‡Œçš„ä¸Žç™»å½•å¯¹äºŽçš„ä»£ç å®Œå…¨ä¸åŒï¼Œä¸å¯èƒ½é€šç”¨ï¼Œæ‰€ä»¥ï¼Œå’±åªèƒ½åšåˆ°è¿™ä¸€æ­¥äº†ï¼Œå“ˆå“ˆå“ˆã€‚ä¸è¿‡è¿™é‡Œè¿˜æ˜¯ç»™ä½ æä¾›äº†ä¸€ä¸ªèŽ·å–å½“å‰æŽ§åˆ¶å™¨çš„æ–¹æ³•ï¼Œå¯ä»¥ç›´æŽ¥ä½¿ç”¨ 

```
UIViewController *currentVC = [ZYLoginManager currentViewControllerWithWindow:nil];
```

å…¶å®žè‡ªåŠ¨ç™»å½•æ— éžå°±æ˜¯ä¸¤æ­¥

1. èŽ·å–å½“å‰æŽ§åˆ¶å™¨ï¼ŒæŸ¥çœ‹æ˜¯å¦ä¸ºç™»å½•çš„æŽ§åˆ¶å™¨
2. å¦‚æžœæ˜¯ï¼Œåˆ©ç”¨ `performSelector` è°ƒç”¨ç™»å½•éƒ¨åˆ†çš„ä»£ç 

å¦‚æžœä¸æ˜¯ç™»å½•çš„æŽ§åˆ¶å™¨æ€Žä¹ˆåŠžå‘¢ï¼Ÿä¸€èˆ¬çš„ appï¼Œåœ¨æ²¡æœ‰ç™»å½•çš„æ—¶å€™ä¸€èˆ¬ç¬¬ä¸€ä¸ªé¡µé¢å°±æ˜¯ç™»å½•é¡µé¢ï¼Œæˆ–è€…ç‚¹å‡»ä¸€ä¸‹æŸä¸ªæŒ‰é’®ï¼Œè·³è½¬åˆ°ç™»å½•é¡µé¢ï¼Œå…¶å®žèŽ·å–å½“å‰æŽ§åˆ¶å™¨çš„æ—¶å€™ï¼Œå®Œå…¨å¯ä»¥åˆ¤æ–­æ˜¯å¦ä¸ºç¬¬ä¸€ä¸ªé¡µé¢ï¼Œå¦‚æžœæ˜¯ï¼Œå°± `performSelector` è·³è½¬åˆ°ç™»å½•é¡µé¢ï¼Œå†åœ¨ç™»å½•é¡µé¢ `performSelector` è°ƒç”¨ç™»å½•éƒ¨åˆ†çš„ä»£ç ã€‚æ ¹æ®ä¸åŒæƒ…å†µå†åšä¸€äº›è°ƒæ•´å§ã€‚

é™¤äº†æ˜¯å®žçŽ°è¿™ä¸ªæ–¹æ³•ï¼Œä½ è¿˜éœ€è¦åšä¸¤ä»¶äº‹æƒ…ï¼š

* å‘Šè¯‰æˆ‘ä½ ç™»å½•æˆåŠŸäº†ï¼Œå¹¶ä¸”å‘Šè¯‰æˆ‘æ˜¯å“ªä¸ªè´¦å·ï¼Œæˆ‘è¿™æ—¶å€™éœ€è¦éšè—ç™»å½•çš„æ‚¬æµ®çƒï¼Œå¹¶ä¸”ä¸ºä½ ä¿å­˜è´¦å·

```objc
[[NSNotificationCenter defaultCenter] postNotificationName:@"kZYLoginSuccessNotificationKey"
                                                    object:@{account:password}];
```

* å‘Šè¯‰æˆ‘ä½ é€€å‡ºç™»å½•äº†ï¼Œæˆ‘éœ€è¦é‡æ–°å±•ç¤ºç™»å½•æŒ‰é’®ï¼Œæ–¹ä¾¿ä¸‹ä¸€æ¬¡è‡ªåŠ¨ç™»å½•

```objc
[[NSNotificationCenter defaultCenter] postNotificationName:@"kZYLogoutSuccessNotificationKey"
                                                    object:nil];
```

## å®‰å…¨å—ï¼Ÿ

è¿™ä¸œè¥¿ï¼Œèƒ½è·Ÿç€ä¸Šçº¿å—ï¼Œä¸å°å¿ƒè¹¦å‡ºæ¥ä¸ªæ‚¬æµ®çƒç»™ç”¨æˆ·çœ‹åˆ°é‚£ä¸æ˜¯å°´å°¬äº†ã€‚ä¸èƒ½æºå¸¦ä¸Šçº¿çš„è¯ï¼Œæ¯æ¬¡ä¸Šçº¿è¿˜å¾—åˆ é™¤ï¼Œå¤šéº»çƒ¦å•Šã€‚ðŸ˜Ž è¿™ä¸ªå¤§å¯æ”¾å¿ƒï¼Œæˆ‘å·²ç»å¸¦ç€å®ƒä¸Šçº¿äº† n ä¸ªç‰ˆæœ¬äº†ï¼Œè€Œä¸”å‡ ä¹Žæ‰€æœ‰ä»£ç æˆ‘éƒ½åŠ ä¸Šäº†

```
#if DEBUG
...
#endif
```

æ‰€ä»¥æ ¹æœ¬ä¸éœ€è¦æ‹…å¿ƒï¼Œåªè¦å·¥ç¨‹æ”¹ä¸º `release` æ¨¡å¼è¿è¡ŒåŽ‹æ ¹å°±å‡ºçŽ°ä¸äº†æ‚¬æµ®çƒï¼Œé‡Œé¢çš„ä»£ç æ ¹æœ¬ä¹Ÿä¸ä¼šæ‰§è¡Œã€‚

æˆ‘çš„å»ºè®®æ˜¯åƒæˆ‘ demo é‡Œé¢é‚£æ ·ï¼Œå†™ä¸€ä¸ª `config` ç±»ï¼Œå°†ä¸Šé¢æ‰€æœ‰å¸¸ç”¨çš„æµ‹è¯•ä»£ç å’Œæµ‹è¯•è´¦å·éƒ½å†™åœ¨è¿™é‡Œç±»é‡Œé¢ï¼Œæ”¾åœ¨ä¸€èµ·ï¼Œå°†æ±¡æŸ“åšåˆ°æœ€å°ã€‚å¦‚æžœä½ è¿™æ ·åšäº†ï¼Œåœ¨è¿™é‡Œ `config` ç±»çš„ `setup` æ–¹æ³•å†åŠ ä¸Šä¸€ä¸ª `#if DEBUG`ï¼Œä½ ä¼šå‘çŽ° `TestManager` å’Œ `LoginManager` è¿™ä¸¤ä¸ªå•ä¾‹å¯¹è±¡æ ¹æœ¬å°±ä¸ä¼šåˆå§‹åŒ–ï¼Œè¿˜æœ‰ä»€ä¹ˆå¯æ‹…å¿ƒçš„ã€‚

åŸºæœ¬å°±è¿™ä¹ˆå¤šå§ï¼Œå¦‚æžœä½ è§‰å¾—æœ‰ç”¨çš„è¯ï¼Œè¯·ä¸è¦åå•¬ä½ çš„ starðŸŒ¹ å“¦ï¼

> * æœ¬æ–‡æ°¸ä¹…æ›´æ–°é“¾æŽ¥ï¼š<https://ripperhe.com/2017/03/10/suspension-view>
> * ä½œè€…ï¼š[ripperhe](https://github.com/ripperhe)